const { capitalizeString } = require('../const/func.js');
const { osuNomod, osuHidden, osuHardrock, osuDoubletime, osuEasy, osuFlashlight } = require('../const/string.js');
const { gameModes } = require('../const/map.js');
const { osuColor } = require('../const/color.js');

async function showBetmapInfo(data, ppcalc, mode) {
	let finalCapitalizedString = await capitalizeString(data.status);

	const seconds = data.hit_length;
	const minutes = Math.floor(seconds / 60);
	const remainingSeconds = seconds % 60;

	if (mode in gameModes) {
		mode = gameModes[mode];
	} else {
		mode = '';
	}

	const ppcalcSingleMod = `${osuNomod} ${ppcalc.get("nm")}pp\n` +
		`${osuHidden} ${ppcalc.get("hd")}pp\n` +
		`${osuHardrock} ${ppcalc.get("hr")}pp\n` +
		`${osuDoubletime} ${ppcalc.get("dt")}pp\n` +
		`${osuEasy} ${ppcalc.get("ez")}pp\n` +
		`${osuFlashlight} ${ppcalc.get("fl")}pp\n`

	const ppcalcDoubleMod = `${osuHidden}${osuHardrock} ${ppcalc.get("hdhr")}pp\n` +
		`${osuHidden}${osuDoubletime} ${ppcalc.get("hddt")}pp\n` +
		`${osuEasy}${osuDoubletime} ${ppcalc.get("ezdt")}pp\n`

	const beatmapEmbed = {
		color: osuColor,
		author: {
			name: `${data.beatmapset.artist} - ${data.beatmapset.title} (${data.version})`,
			url: data.url,
		},
		description: `Beatmap by ${data.beatmapset.creator}`,
		fields: [
			{
				name: 'Circle Size',
				value: `${data.cs}`,
				inline: true,
			},
			{
				name: 'Approach Rate',
				value: `${data.ar}`,
				inline: true,
			},
			{
				name: 'Overall Difficulty',
				value: `${data.accuracy}`,
				inline: true,
			},
			{
				name: 'Star Rating',
				value: `${data.difficulty_rating}`,
				inline: true,
			},
			{
				name: 'BPM',
				value: `${data.bpm}`,
				inline: true,
			},
			{
				name: 'Length',
				value: `${minutes} minutes ${remainingSeconds} seconds`,
				inline: true,
			},
			{
				name: 'Possible pp gained on 100% accuracy:',
				value: '',
				inline: false,
			},
			{
				name: '',
				value: ppcalcSingleMod,
				inline: true,
			},
			{
				name: '',
				value: ppcalcDoubleMod,
				inline: true,
			},
			{
				name: '\u200b',
				value: '\u200b',
				inline: true,
			},
		],
		image: {
			url: `https://assets.ppy.sh/beatmaps/${data.beatmapset_id}/covers/cover.jpg`,
		},
		footer: {
			text: `${finalCapitalizedString} • ${data.beatmapset.favourite_count} Favorites • ${data.playcount} Playcounts • osu!${mode}`,
		},
	};

	return beatmapEmbed;
}

module.exports = { showBetmapInfo }